# CI/CD Pipeline - Container Steps

## Overview

As software development scales, traditional CI/CD workflows often become complex and harder to maintain. A container-centric approach to CI/CD simplifies pipeline definitions, enhances modularity, and improves maintainability at scale. By encapsulating CI/CD logic and tooling within versioned containers, organizations can streamline processes, strengthen governance, and provide a consistent experience for developers. This approach allows for reusable workflows across different projects, reducing duplication of effort.

## Impact

Adopting a container-centric approach to CI/CD can have the following impacts on the organization:

- **Improved maintainability**: Simplified pipeline definitions and modularity make it easier to maintain CI/CD workflows at scale.
- **Consistency**: Version-controlled containers ensure consistent environments across development and production.
- **Governance and compliance**: Centralized management of container versions strengthens governance and compliance controls.
- **Developer experience**: Developers benefit from a more consistent and streamlined CI/CD process.

## Key Considerations

- Simplified workflow definitions
- Enhanced modularity and reusability
- Improved version management
- Easier maintenance and updates
- Stronger governance and compliance controls
- Consistent environments across development and production
- Improved testability of pipeline steps
- Enhanced security through isolation
- Real-time inventory and analytics of CI/CD tools (see seperate proposal)

## Stakeholders

| Stakeholder     | Role/Department   |
| --------------- | ----------------- |
| [Stakeholder 1] | [Role/Department] |
| [Stakeholder 2] | [Role/Department] |
| [Stakeholder 3] | [Role/Department] |
| ...             | ...               |

## Background Information

The container-centric approach involves:

1. Encapsulating CI/CD logic and tooling within containers.
2. Simplifying workflow definitions to focus on orchestration.
3. Version controlling entire CI/CD steps as container images.

This approach addresses common challenges such as complex YAML files, inconsistent environments, and difficulties in managing tool versions across multiple projects.

### Example: Traditional vs. Container-Centric Workflow

Here’s the updated example with custom internal images named `terraformOps`, which simulate an internal Terraform operations image for both the traditional and container-centric workflows.

**Traditional CI/CD Workflow**:

```yaml
# Traditional approach with custom TerraformOps image
name: Traditional Terraform Plan and Apply
on: [push]
jobs:
  terraform:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Terraform (Internal Image)
        run: |
          docker pull internal-registry/terraformOps:v1.0
          docker run internal-registry/terraformOps:v1.0 terraform init
      - name: Terraform Plan
        run: |
          docker run internal-registry/terraformOps:v1.0 terraform plan -out=tfplan
      - name: Terraform Apply
        run: |
          docker run internal-registry/terraformOps:v1.0 terraform apply -input=false tfplan
```

**Container-Centric CI/CD Workflow**:

```yaml
# Container-centric approach with custom TerraformOps image
name: Container-Based Terraform Plan and Apply
on: [push]
jobs:
  terraform:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Terraform Plan
        uses: docker://internal-registry/terraformOps:v1.0
        with:
          args: plan -out=tfplan
      - name: Terraform Apply
        uses: docker://internal-registry/terraformOps:v1.0
        with:
          args: apply -input=false tfplan
```


### Proposal 2: [Alternative Proposal Title]

- **Description**: [Brief description of the alternative proposal]
- **Pros**:
  - [Pro 1]
  - [Pro 2]
- **Cons**:
  - [Con 1]
  - [Con 2]

## Questions for Discussion

- TODO

## Next Steps

[Outline the next steps in the decision-making process, such as scheduling a meeting, gathering additional information, etc.]

## References

- [Link 1]
- [Link 2]

## Action Items and Outstanding Research

- **Action Item 1**: [Description and owner]
- **Research Item 1**: [Description and assigned person/team]
- **Blocker 1**: [Description of what's preventing decision/completion and what's needed to resolve it]

## Decision Outcome

- **Decision**: [Briefly state the decision that was made]
- **Date**: [Date the decision was made]
- **Rationale**: [Explain the reasoning behind the decision]
- **Implications**: [Describe any significant implications or next steps resulting from this decision]

### Dissenting Opinions (if any)

[Document any significant dissenting opinions, if applicable]


---

# CICD Pipeline: Cuelang Schema

## Overview

This proposal introduces the use of CUE (Configuration Unification Engine) to enforce governance, security, and standardization across CI/CD pipelines in an organization. By leveraging CUE’s schema enforcement capabilities, we can ensure that certain steps are always performed in the correct order, restrict the versions of containerized steps, and guarantee that the tool reporting feature (from another proposal) is executed in every pipeline.

## Introduction to CUE

CUE is a configuration language designed to simplify the management of complex configurations. It was created by the same team behind Open Policy Agent (OPA), a popular tool for policy enforcement. While OPA focuses on policy as code, CUE is designed to enforce schemas and configurations, making it ideal for advanced policy as code applications. CUE allows you to define schemas that can validate configurations, ensuring that they adhere to organizational standards.

## Impact

Adopting CUE for CI/CD pipeline management will provide the following benefits:

1. **Governance**: Enforce that specific steps are always included in pipelines, such as security checks or compliance steps.
2. **Security**: Restrict the versions of containerized steps to ensure that only approved versions are used.
3. **Standardization**: Ensure that all pipelines follow a consistent structure, reducing the risk of misconfigurations.

## Key Considerations

- Requires integration of CUE into existing CI/CD workflows.
- Teams will need to adopt CUE for pipeline management, which may involve a learning curve.
- Centralized management of CUE schemas will be necessary to ensure consistency across the organization.

## Background Information

One of the key challenges in managing CI/CD pipelines is the lack of consistency across teams. Each pipeline can look wildly different, and teams can bypass critical governance enforcement steps by simply omitting them from their YAML configuration. This creates significant risks, as important steps like security scans or compliance checks may be skipped.

By using CUE to define a schema for pipelines, we can enforce that certain steps are always included and executed in the correct order. This ensures that governance and security requirements are met consistently across all pipelines. Additionally, CUE can restrict the versions of containerized steps, ensuring that only approved versions are used, which is crucial for maintaining security and compliance.

## Proposal: CUE-Based Pipeline Enforcement

- **Description**: This proposal introduces a pattern for using CUE to enforce governance, security, and standardization in CI/CD pipelines. By defining a schema for pipelines, we can ensure that certain steps are always performed and restrict the versions of containerized steps.
- **Cons**:
  - Requires teams to adopt CUE for pipeline management.
  - Initial setup effort for defining and maintaining CUE schemas.

## Questions for Discussion

- TODO

## Next Steps

1. TODO

## References

-

## Action Items and Outstanding Research

-

## Decision Outcome

- **Decision**: [To be filled after the decision is made]
- **Date**: [To be filled after the decision is made]
- **Rationale**: [To be filled after the decision is made]
- **Implications**: [To be filled after the decision is made]

---

# CICD Pipelines: Automatic Inventory of Tooling Versions

## Overview

This proposal introduces a mechanism to automatically track and manage the versions of tools and containers used in CI/CD pipelines. By leveraging containerized steps, each step will record the tool versions used, and the data will be stored in a centralized database for reporting, monitoring, and compliance.

## Impact

Adopting this approach will provide the following benefits:

1. **Real-time visibility**: Track the versions of tools and containers used across all pipelines.
2. **Compliance monitoring**: Ensure that all pipelines are using approved versions of tools and containers.
3. **Data-driven upgrade planning**: Identify outdated tools and plan upgrades based on collected data.
4. **Security management**: Quickly identify pipelines using vulnerable or outdated versions of tools.

## Key Considerations

- Will require eventual conversion of existing CI/CD workflows
- Centralized database for storing inventory data
- Mechanism for updating the local inventory file during each pipeline step (could be a local file in the workspace)
- Final step to submit the inventory data to the centralized database
- Dashboards and reporting tools for monitoring tool usage

## Stakeholders

| Stakeholder     | Role/Department   |
| --------------- | ----------------- |
| [Stakeholder 1] | [Role/Department] |
| [Stakeholder 2] | [Role/Department] |
| [Stakeholder 3] | [Role/Department] |
| ...             | ...               |

## Background Information

It can be challenging to ensure that all teams within an organization consistently use only supported tooling, Infrastructure as Code (IaC) providers, and container versions. This proposal introduces a mechanism to track, monitor, alert, and enforce the versions being used in CI/CD pipelines, ensuring compliance and consistency across the organization.

## Proposals

### Proposal 1: Container-Based Inventory Tracking

- **Description**: This proposal introduces a pattern for building container-centric steps that can report the versions of tooling and even their own container versions. Each container step will update a local inventory file with the tool versions used, which will be submitted to a centralized database at the end of the pipeline.
- **Pros**:
  - Real-time visibility into tool usage
  - Simplified compliance monitoring
  - Data-driven upgrade planning
- **Cons**:
  - Requires integration with existing pipelines
  - Initial setup effort for the centralized database and reporting tools

### Proposal 2: [Alternative Proposal Title]

- **Description**: [Brief description of the alternative proposal]
- **Pros**:
  - [Pro 1]
  - [Pro 2]
- **Cons**:
  - [Con 1]
  - [Con 2]

## Questions for Discussion

-

## Next Steps

1.

## References

-

## Action Items and Outstanding Research

-

## Decision Outcome

- **Decision**: [Briefly state the decision that was made]
- **Date**: [Date the decision was made]
- **Rationale**: [Explain the reasoning behind the decision]
- **Implications**: [Describe any significant implications or next steps resulting from this decision]

### Dissenting Opinions (if any)

[Document any significant dissenting opinions, if applicable]
